# 2026-02-13

## Task
Create a hardware-free mock-run workflow that previews exact deck coordinates for a sample 3-well protocol using `configs/deck.sample.yaml`.

## Work Completed
- Added TDD coverage in `tests/protocol_engine/test_preview.py` for:
  - Resolving three sample move targets (`plate_1.A1`, `plate_1.C8`, `plate_1.B1`) to exact XYZ coordinates.
  - Rendering human-readable mock-run output for terminal use.
- Implemented preview utility in `src/protocol_engine/preview.py`:
  - `preview_protocol_moves(deck_path, protocol_path)` resolves `move` steps to absolute coordinates via deck + protocol loaders.
  - `format_move_preview(...)` prints a clear table with step index, instrument, target, and XYZ.
- Added CLI script `preview_protocol.py`:
  - Defaults to `configs/deck.sample.yaml` and `experiments/sample_three_well_protocol.yaml`.
  - Supports overrides via `--deck` and `--protocol`.
  - Explicitly mock-only (no hardware commands sent).
- Added sample protocol file `experiments/sample_three_well_protocol.yaml` with three well moves.
- Added hardware execution path:
  - `src/protocol_engine/hardware_run.py` for protocol execution on gantry hardware with configurable instrument mount offsets.
  - `run_protocol_hardware.py` CLI that previews coordinates, prints applied offsets, and requires explicit `RUN` confirmation before execution.
- Updated docs:
  - `README.md` with mock-preview usage.
  - `AGENTS.md` with references to the sample protocol and preview script.

## Validation
- Ran: `python -m pytest tests/protocol_engine/test_preview.py` -> `2 passed`
- Ran: `python preview_protocol.py` and confirmed output:
  - `plate_1.A1 -> (-10.000, -10.000, -15.000)`
  - `plate_1.C8 -> (53.000, -28.000, -15.000)`
  - `plate_1.B1 -> (-10.000, -19.000, -15.000)`
- Ran: `python -m pytest tests/protocol_engine/test_hardware_run.py` -> `2 passed`

## Issues Found and Resolution
- Initial test run failed due to missing module (`src.protocol_engine.preview`) and missing sample protocol file.
- Resolved by implementing `preview.py` and adding `experiments/sample_three_well_protocol.yaml`, then re-running tests.

## Notes
- No hardware commands were executed; all verification was done through unit tests and a mock-only preview script.
