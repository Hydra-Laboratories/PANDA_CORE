# Progress — 2026-02-16

## Task: Migrate Board Helpers to Protocol Commands

### Summary
Moved all pipette helpers (`aspirate`, `dispense`, `blowout`, `mix`, `pick_up_tip`, `drop_tip`) and `scan()` from `Board` into protocol engine commands so they are callable from YAML protocols. Board is now a thin wrapper holding gantry + instruments with just `move()` and `object_position()`.

Additionally relocated `board.py` from `src/protocol_engine/` to `src/board/` where it logically belongs alongside the board loader and schema.

### Files Created
- **`src/protocol_engine/commands/pipette.py`** — 6 pipette protocol commands with shared `_get_pipette()` helper that raises `ProtocolExecutionError`
- **`src/protocol_engine/commands/scan.py`** — scan command that loops over wells in row-major order, validates plate type and instrument/method
- **`tests/protocol_engine/test_pipette_commands.py`** — 30 tests covering all 6 pipette commands (resolve, move-before-action, args, defaults, no-pipette error)
- **`tests/protocol_engine/test_scan_command.py`** — 11 tests covering well traversal, measurement_height, return types, validation errors

### Files Moved
- **`src/protocol_engine/board.py`** → **`src/board/board.py`** — Board class now lives with the board loader
- **`tests/protocol_engine/test_board.py`** → **`tests/board/test_board.py`** — Board tests co-located with board module

### Files Modified
- **`src/board/__init__.py`** — Exports `Board` from new location
- **`src/board/loader.py`** — Updated import to `src.board.board`
- **`src/protocol_engine/__init__.py`** — Updated import to `src.board.board`
- **`src/protocol_engine/protocol.py`** — Updated import to `src.board.board`
- **`src/protocol_engine/commands/__init__.py`** — Registered `pipette` and `scan` modules via side-effect imports
- **`tests/board/test_board_loader.py`** — Updated import to `src.board`
- **`tests/protocol_engine/test_move_command.py`** — Added `from __future__ import annotations` to fix Python 3.9 union type syntax
- **`configs/protocol.sample.yaml`** — Added examples for all new commands (pipette ops + scan)

### Issues Encountered
- **Python 3.9 `X | None` syntax**: Test files using `Coordinate3D | None = None` in function signatures failed at collection time. Fixed by adding `from __future__ import annotations` to all affected test files.

### Verification
- `tests/protocol_engine/` — 92 tests passed
- `tests/board/` — 38 tests passed (board + board loader)
- `tests/instruments/` — 110 tests passed (no regressions)
- Total: 240 tests passing
